<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bounding Box Viewer</title>
    <!-- Use Tailwind CSS for a modern, responsive design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .image-container {
            position: relative;
            width: 100%;
            height: auto;
            max-width: 800px;
            margin: 0 auto;
        }
        .image-container img {
            width: 100%;
            height: auto;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .bbox-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .bounding-box {
            position: absolute;
            box-sizing: border-box;
            border: 2px solid #3b82f6; /* Default border color */
            background-color: rgba(59, 130, 246, 0.2); /* Default semi-transparent background */
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            border-radius: 0.25rem;
            opacity: 0.5; /* Initial opacity */
        }
        .bounding-box:hover {
            opacity: 0.8;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }
        .bounding-box.active {
            border: 2px solid #ef4444; /* Active border color */
            background-color: rgba(239, 68, 68, 0.3); /* Active background color */
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 p-4 sm:p-8">

    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl sm:text-4xl font-bold text-center mb-6 text-gray-900">Document Reviewer</h1>
        <p class="text-center text-gray-600 mb-8 max-w-2xl mx-auto"></p>
        
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8 flex flex-col lg:flex-row items-center justify-center space-y-8 lg:space-y-0 lg:space-x-8">
            <!-- Image Container with Overlay -->
            <div class="image-container flex-shrink-0">
                <!-- Document Image -->
                <img id="document-image" src="resources/sample_invoice.jpeg" alt="Sample Document with Extracted Data" class="w-full h-auto rounded-lg shadow-md" onerror="this.onerror=null; this.src='https://placehold.co/1984x2807/e0e0e0/333333?text=Image+Load+Failed';" />
                <!-- Bounding Box Overlay Container -->
                <div id="bbox-overlay" class="bbox-overlay"></div>
            </div>

            <!-- Extracted Data Panel -->
            <div class="w-full lg:w-1/3 bg-gray-50 p-6 rounded-lg shadow-inner">
                <h2 class="text-2xl font-semibold mb-4 text-gray-700">Extracted Content</h2>
                <div id="selected-text" class="min-h-[100px] bg-white border border-gray-300 rounded-md p-4 text-gray-700 font-mono text-sm leading-relaxed whitespace-pre-wrap">
                    Click a box to see the extracted text here.
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data from the API, with an example structure
        const apiResponse = {
            "width": 1984,
            "height": 2807,
            "results": {
                "1": [
                    {
                        "word_boxes": [
                            {
                                "bbox": [[130, 147], [253, 202]],
                                "content": "Apple"
                            },
                            {
                                "bbox": [[271, 143], [383, 198]],
                                "content": "Store"
                            }
                        ],
                        "bbox": [[129, 143], [384, 202]]
                    },
                    {
                        "word_boxes": [
                            {
                                "bbox": [[132, 204], [187, 236]],
                                "content": "One"
                            },
                            {
                                "bbox": [[200, 206], [286, 238]],
                                "content": "Infinite"
                            },
                            {
                                "bbox": [[298, 208], [364, 240]],
                                "content": "Loop"
                            }
                        ],
                        "bbox": [[133, 204], [364, 241]]
                    },
                    {
                        "word_boxes": [
                            {
                                "bbox": [[132, 255], [318, 292]],
                                "content": "Cupertino,CA"
                            },
                            {
                                "bbox": [[326, 253], [409, 289]],
                                "content": "95014"
                            }
                        ],
                        "bbox": [[132, 253], [409, 292]]
                    },
                    {
                        "word_boxes": [
                            {
                                "bbox": [[132, 308], [201, 342]],
                                "content": "(408)"
                            },
                            {
                                "bbox": [[212, 305], [341, 341]],
                                "content": "606-5775"
                            }
                        ],
                        "bbox": [[132, 305], [341, 343]]
                    },
                    {
                        "word_boxes": [
                            {
                                "bbox": [[133, 360], [270, 393]],
                                "content": "[Company"
                            },
                            {
                                "bbox": [[282, 359], [361, 393]],
                                "content": "Emaill"
                            },
                            {
                                "bbox": [[371, 359], [490, 392]],
                                "content": "Address]"
                            }
                        ],
                        "bbox": [[133, 359], [490, 394]]
                    },
                    {
                        "word_boxes": [
                            {
                                "bbox": [[1638, 583], [1842, 633]],
                                "content": "Invoice"
                            }
                        ],
                        "bbox": [[1638, 583], [1842, 633]]
                    },
                    {
                        "word_boxes": [
                            {
                                "bbox": [[142, 720], [185, 747]],
                                "content": "Bill"
                            },
                            {
                                "bbox": [[194, 720], [229, 747]],
                                "content": "To"
                            },
                            {
                                "bbox": [[292, 719], [384, 746]],
                                "content": "Future"
                            },
                            {
                                "bbox": [[395, 718], [445, 745]],
                                "content": "Inc."
                            }
                        ],
                        "bbox": [[142, 718], [445, 747]]
                    },
                    {
                        "word_boxes": [
                            {
                                "bbox": [[295, 771], [357, 798]],
                                "content": "5584"
                            },
                            {
                                "bbox": [[378, 772], [457, 798]],
                                "content": "Nickel"
                            },
                            {
                                "bbox": [[470, 772], [538, 798]],
                                "content": "Road"
                            },
                            {
                                "bbox": [[1502, 750], [1605, 774]],
                                "content": "Invoice"
                            },
                            {
                                "bbox": [[1619, 751], [1659, 775]],
                                "content": "no."
                            },
                            {
                                "bbox": [[1711, 751], [1826, 775]],
                                "content": "9001321"
                            }
                        ],
                        "bbox": [[295, 744], [1826, 802]]
                    },
                    {
                        "word_boxes": [
                            {
                                "bbox": [[293, 822], [386, 852]],
                                "content": "KINTA,"
                            },
                            {
                                "bbox": [[399, 822], [535, 852]],
                                "content": "Oklahoma"
                            },
                            {
                                "bbox": [[548, 822], [630, 851]],
                                "content": "74552"
                            },
                            {
                                "bbox": [[1596, 801], [1656, 827]],
                                "content": "Date"
                            },
                            {
                                "bbox": [[1711, 802], [1845, 828]],
                                "content": "2/20/2020"
                            }
                        ],
                        "bbox": [[293, 795], [1845, 857]]
                    },
                    {
                        "word_boxes": [
                            {
                                "bbox": [[140, 897], [194, 923]],
                                "content": "Attn"
                            },
                            {
                                "bbox": [[297, 897], [375, 923]],
                                "content": "Linda"
                            },
                            {
                                "bbox": [[387, 896], [483, 922]],
                                "content": "Owens"
                            }
                        ],
                        "bbox": [[140, 896], [483, 924]]
                    },
                    {
                        "word_boxes": [
                            {
                                "bbox": [[149, 979], [313, 1014]],
                                "content": "Description"
                            },
                            {
                                "bbox": [[1253, 978], [1375, 1013]],
                                "content": "Quantity"
                            },
                            {
                                "bbox": [[1408, 978], [1465, 1012]],
                                "content": "Unit"
                            },
                            {
                                "bbox": [[1476, 978], [1547, 1012]],
                                "content": "price"
                            },
                            {
                                "bbox": [[1574, 978], [1683, 1012]],
                                "content": "Amount"
                            }
                        ],
                        "bbox": [[149, 977], [1683, 1014]]
                    },
                    {
                        "word_boxes": [
                            {
                                "bbox": [[149, 1054], [234, 1081]],
                                "content": "Phone"
                            },
                            {
                                "bbox": [[245, 1054], [274, 1081]],
                                "content": "11"
                            },
                            {
                                "bbox": [[289, 1054], [333, 1081]],
                                "content": "Pro"
                            },
                            {
                                "bbox": [[344, 1054], [436, 1082]],
                                "content": "256GB"
                            },
                            {
                                "bbox": [[450, 1054], [509, 1082]],
                                "content": "Gold"
                            },
                            {
                                "bbox": [[1253, 1053], [1263, 1085]],
                                "content": "1"
                            },
                            {
                                "bbox": [[1406, 1053], [1540, 1085]],
                                "content": "$1,149.00"
                            },
                            {
                                "bbox": [[1576, 1053], [1711, 1085]],
                                "content": "$1,149.00"
                            }
                        ],
                        "bbox": [[149, 1051], [1711, 1086]]
                    },
                    {
                        "word_boxes": [
                            {
                                "bbox": [[150, 1128], [225, 1158]],
                                "content": "Apple"
                            },
                            {
                                "bbox": [[234, 1128], [318, 1159]],
                                "content": "Watch"
                            },
                            {
                                "bbox": [[331, 1128], [420, 1159]],
                                "content": "Edition"
                            },
                            {
                                "bbox": [[433, 1129], [494, 1159]],
                                "content": "GPS"
                            },
                            {
                                "bbox": [[506, 1129], [521, 1159]],
                                "content": "+"
                            },
                            {
                                "bbox": [[534, 1129], [640, 1159]],
                                "content": "Cellular,"
                            },
                            {
                                "bbox": [[653, 1129], [735, 1159]],
                                "content": "44mm"
                            },
                            {
                                "bbox": [[748, 1129], [832, 1160]],
                                "content": "Space"
                            },
                            {
                                "bbox": [[845, 1126], [916, 1155]],
                                "content": "Black"
                            },
                            {
                                "bbox": [[927, 1126], [1041, 1155]],
                                "content": "Titanium"
                            },
                            {
                                "bbox": [[1052, 1126], [1122, 1155]],
                                "content": "Case"
                            },
                            {
                                "bbox": [[1132, 1126], [1183, 1155]],
                                "content": "with"
                            },
                            {
                                "bbox": [[1255, 1126], [1263, 1156]],
                                "content": "1"
                            },
                            {
                                "bbox": [[1406, 1126], [1515, 1156]],
                                "content": "$849.00"
                            },
                            {
                                "bbox": [[1576, 1126], [1684, 1156]],
                                "content": "$849.00"
                            }
                        ],
                        "bbox": [[150, 1124], [1684, 1162]]
                    },
                    {
                        "word_boxes": [
                            {
                                "bbox": [[150, 1177], [244, 1210]],
                                "content": "Anchor"
                            },
                            {
                                "bbox": [[254, 1178], [318, 1211]],
                                "content": "Gray"
                            },
                            {
                                "bbox": [[329, 1179], [402, 1212]],
                                "content": "Sport"
                            },
                            {
                                "bbox": [[410, 1180], [477, 1213]],
                                "content": "Loop"
                            }
                        ],
                        "bbox": [[151, 1177], [476, 1213]]
                    },
                    {
                        "word_boxes": [
                            {
                                "bbox": [[1407, 1250], [1475, 1283]],
                                "content": "Total"
                            },
                            {
                                "bbox": [[1573, 1252], [1707, 1286]],
                                "content": "$1,998.00"
                            }
                        ],
                        "bbox": [[1407, 1250], [1706, 1286]]
                    },
                    {
                        "word_boxes": [
                            {
                                "bbox": [[136, 1446], [179, 1472]],
                                "content": "Net"
                            },
                            {
                                "bbox": [[191, 1447], [222, 1473]],
                                "content": "10"
                            },
                            {
                                "bbox": [[233, 1458], [240, 1467]],
                                "content": "-"
                            },
                            {
                                "bbox": [[251, 1446], [376, 1479]],
                                "content": "Payment"
                            },
                            {
                                "bbox": [[385, 1446], [424, 1478]],
                                "content": "ten"
                            },
                            {
                                "bbox": [[436, 1445], [497, 1478]],
                                "content": "days"
                            },
                            {
                                "bbox": [[508, 1445], [572, 1477]],
                                "content": "after"
                            },
                            {
                                "bbox": [[575, 1444], [679, 1477]],
                                "content": "invoice"
                            },
                            {
                                "bbox": [[688, 1443], [754, 1476]],
                                "content": "date."
                            }
                        ],
                        "bbox": [[137, 1443], [754, 1479]]
                    }
                ]
            }
        };

        function drawBoundingBoxes() {
            const image = document.getElementById('document-image');
            const overlay = document.getElementById('bbox-overlay');
            const selectedTextDiv = document.getElementById('selected-text');

            // Clear previous bounding boxes
            overlay.innerHTML = '';
            
            // Wait for the image to load to get its dimensions
            if (image.complete) {
                renderBoxes();
            } else {
                image.onload = renderBoxes;
            }

            function renderBoxes() {
                // Get the displayed dimensions of the image
                const displayedWidth = image.offsetWidth;
                const displayedHeight = image.offsetHeight;

                // Original dimensions from the API response
                const originalWidth = apiResponse.width;
                const originalHeight = apiResponse.height;

                // Calculate the scaling factors
                const scaleX = displayedWidth / originalWidth;
                const scaleY = displayedHeight / originalHeight;

                // Loop through all the results on the first page
                const boxes = apiResponse.results["1"];
                if (boxes) {
                    boxes.forEach((data, index) => {
                        const bbox = data.bbox;
                        const [
                            [x1, y1],
                            [x2, y2]
                        ] = bbox;

                        // Calculate the scaled dimensions and position
                        const left = x1 * scaleX;
                        const top = y1 * scaleY;
                        const width = (x2 - x1) * scaleX;
                        const height = (y2 - y1) * scaleY;

                        // Create the bounding box element
                        const boxElement = document.createElement('div');
                        boxElement.className = 'bounding-box';
                        boxElement.style.left = `${left}px`;
                        boxElement.style.top = `${top}px`;
                        boxElement.style.width = `${width}px`;
                        boxElement.style.height = `${height}px`;
                        
                        // Join all the word content to get the full text for the box
                        const extractedText = data.word_boxes.map(word => word.content).join(' ');
                        boxElement.dataset.content = extractedText;

                        // Add a click listener to show the text
                        boxElement.addEventListener('click', () => {
                            // Remove 'active' class from all other boxes
                            document.querySelectorAll('.bounding-box').forEach(box => {
                                box.classList.remove('active');
                            });
                            // Add 'active' class to the clicked box
                            boxElement.classList.add('active');
                            // Display the content in the text panel
                            selectedTextDiv.textContent = extractedText;
                        });

                        // Append the box to the overlay
                        overlay.appendChild(boxElement);
                    });
                }
            }
        }
        
        // Initial draw when the DOM is ready
        document.addEventListener('DOMContentLoaded', drawBoundingBoxes);
        
        // Redraw on window resize to ensure boxes scale correctly
        window.addEventListener('resize', drawBoundingBoxes);

    </script>
</body>
</html>
